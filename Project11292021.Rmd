---
title: "Project11292021"
author: "Riad Alharithi"
date: "12/1/2021"
output: pdf_document
---

$i$ is set of Employees {Emp1, Em2, ..}

$j$ is set of projects { P1, P2, ..}

$k$ is set of classifications {PM, Senior Engineer, Junior Engineer, Senior Designer, Junior Designer, CAD Drafter, Surveyor}

[**Variable:**]{.ul}

$X_i,_j,_k$ [Continuous]{.ul}: Hours that an employee $i$ work in functional class $k$ in project $j$

$Y_i,_j,_k$ = ${0, 1}$ [Binary]{.ul} variable, If employee $i$ is assigned to classification $k$ for project $j$ then $y_i,_j,_k$is 1 otherwise it is 0.

### Data

$S_{i,k}$ =1 [Binary]{.ul}, if employee is qualified to do task $k$

$P_i,_k$: [Continuous]{.ul}, Profit = Hourly rate for employee $i$ classification $k$ in project $j$ \* 10% \*

$E_j$ : [Continuous]{.ul}, Project budget = Not to Exceed (NTE) cost per project

$R_{i,k}$: [Continuous]{.ul}, billing rate for $i$ when performing task classification $k$

$T_{j,k}$ [Continuous]{.ul}, Total hours per project for task classification $k$

[**Objective Function:**]{.ul}

$$
 \begin{split}
 \begin{aligned}
    \text{Maximize  }   &  \sum_{i} \sum_{j} \sum_{k} X_{i,j,k} P_{i,k} \\
 \end{aligned}
 \end{split}
$$

[**Constraints**]{.ul}

Utilization: Total hours assigned to a staff who classified as engineer/ designer/ surveyor should not exceed 1664 hours per year.

$\sum_{j=1}^{j=NProj} \sum_{k=1}^{k=10} X_{i,j,k} \leq1664 \,\text { hours } \forall i$

Budget Constraints: every project has its budget $E_j$.
The total hours assigned to staff $i$ on project $j$ multiplied by the hourly rate for the classification $k$ he is performing should be less than $E_j$

$\sum_{j=1}^{j=NProj} \sum_{k=1}^{k=3} R_{i,k}\cdot X_{i,j,k} \leq E_j \,\ \forall j$

$X_{i,j,k}\leq BigM * Y_{i,j,k} \,\forall i,j,k$

Skills set: Every staff $i$ assigned on any project $j$ should have the appropriate skill.
for example, Junior Engineer can not do Senior Engineer task but the opposite is correct.

$Y_{i,j,k}= S_{i,k}\ \forall\ i, j, k$

Total Hours constraints: the total hours for each staff $i$ on every project should be less than or equal than the negotiated hours in the project budget.

$\sum_{i=1}^{i=NP} X_{i,j,k} = T_{j,k} \forall j,k$

Including the libraries:

```{r}
library(ompr, quietly = TRUE)
library(magrittr, quietly = TRUE)
library(pander, quietly = TRUE)
library(ROI, quietly = TRUE)
library(ROI.plugin.glpk, quietly = TRUE)
library(ompr.roi, quietly = TRUE)
library(pander, quietly = TRUE)
library(TRA)
library(Benchmarking, quietly=TRUE)
library(ROI.plugin.glpk)
library(ROI.plugin.lpsolve)
library(ROI.plugin.neos)
library(ROI.plugin.symphony)
library(readr)
#library(ROI.plugin.cplex)
```

```{r Data}

DAta<-readr::read_csv("//Users/riad/!Riad/PhD/Classes/ETM 640/Project/DataEntryFile.csv")
TS<- readr::read_csv("/Users/riad/!Riad/PhD/Classes/ETM 640/Project/StaffSKills.csv")
S<-t(TS)
TP<-readr::read_csv("/Users/riad/!Riad/PhD/Classes/ETM 640/Project/ProfitPerStaff.csv")
P<-t(TP)
Z<-readr::read_csv("/Users/riad/!Riad/PhD/Classes/ETM 640/Project/ProfitPerProjectPerClass.csv")

##Classification of staff
BillingRate <- as.matrix(DAta[,1]) 
##Billing <-matrix(c(200, 186, 120, 135), ncol = 4, nrow = 4,
##                     dimnames = c(list(c("P1", "P2", "P3", "P4")),
##                                  list(c("PM", "Engineer", "Designer", "Surveyor")))
##                     )
## Billing Rates per above classification in order
MaxHours<-1664
## 2080 hours per year multiplied by 80% utilization per staff = 1664
## we will need to change this to be a variable so each class has its ulitzation factor
##ProfitPerStaff<-0.1*BillingRate
##print (ProfitPerStaff)
## profit is assumed 10% per the hourly rate
Employee<-matrix(c("E1","E2", "E3", "E4", "E5", "E6", "E7", "E8", "E9", "E10"), ncol = 10)
## These are all roster of technical staff working at the firm 

n<-10
## Number of Staff
p<-6
##Number of projects
c<-7
## Number of classifications
```

```{r model Variables, objective, Constraints}
model <- MIPModel() 
model<-   add_variable(model, X[i,j,k], i=1:n, j=1:p, k=1:c, lb=0, type= "continuous")
  
model<- add_variable(model, Y[i,j,k], i=1:n, j=1:p, k=1:c, type = "binary") 
model<- set_objective(model, sum_expr((X[i,j,k]*P[i,k]), i=1:n, j=1:p, k=1:c), "max")
    
model<- add_constraint (model, Y[i,j,k]==S[i,k], i=1:n, j=1:p, k=1:c)
  
model<- add_constraint(model,sum_expr(X[i,j,k], i=1:n, j=1:p, k=1:c)<=1664)

result <- solve_model(model, with_ROI(solver = "glpk"))
result
```
